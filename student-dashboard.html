<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduMalawi - Student Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom CSS for features Tailwind doesn't cover easily */
        .gradient-bg {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        .sidebar {
            transition: all 0.3s ease;
        }
        .assignment-card:hover, .portal-card:hover, .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse {
            animation: pulse 1.5s infinite;
        }
        /* Modals are hidden by default */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <nav class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-book-open text-2xl"></i>
                <span class="text-xl font-bold">EduMalawi</span>
            </div>
            <div class="hidden md:flex items-center space-x-4">
                <a href="#" class="hover:text-gray-200">Dashboard</a>
                <a href="#" class="hover:text-gray-200">Courses</a>
                <a href="#" class="hover:text-gray-200">Grades</a>
                <a href="#" class="hover:text-gray-200">Assignments</a>
                <button class="bg-red-600 text-white px-4 py-2 rounded-full hover:bg-red-700 transition duration-300">Logout</button>
            </div>

            <div class="relative ml-4">
                <button id="notification-bell" class="relative p-2 rounded-full hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <i class="fas fa-bell text-white text-xl"></i>
                    <span id="notification-badge" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full hidden">0</span>
                </button>

                <div id="notifications-dropdown" class="absolute right-0 mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-lg z-50 hidden">
                    <div class="p-4">
                        <h3 class="font-semibold text-gray-800 border-b pb-2 mb-2">Notifications</h3>
                        <ul id="notification-list" class="divide-y divide-gray-200">
                            <li class="py-2 text-gray-700 text-sm">No new notifications.</li>
                        </ul>
                        <div class="text-right mt-2">
                            <button id="mark-all-read" class="text-indigo-600 hover:text-indigo-800 text-xs font-medium">Mark all as read</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-white text-2xl focus:outline-none">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-indigo-700">
            <a href="#" class="block px-4 py-2 text-sm text-white hover:bg-indigo-800">Dashboard</a>
            <a href="#" class="block px-4 py-2 text-sm text-white hover:bg-indigo-800">Courses</a>
            <a href="#" class="block px-4 py-2 text-sm text-white hover:bg-indigo-800">Grades</a>
            <a href="#" class="block px-4 py-2 text-sm text-white hover:bg-indigo-800">Assignments</a>
            <button class="block w-full text-left px-4 py-2 text-sm text-white hover:bg-indigo-800">Logout</button>
        </div>
    </nav>

    <div class="flex">
        <aside class="w-64 bg-gray-800 text-white min-h-screen p-6 hidden md:block">
            <h2 class="text-2xl font-bold mb-6">Student Portal</h2>
            <nav>
                <ul>
                    <li class="mb-4">
                        <a href="#" class="flex items-center text-gray-300 hover:text-white transition duration-200">
                            <i class="fas fa-tachometer-alt mr-3"></i> Dashboard
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" class="flex items-center text-gray-300 hover:text-white transition duration-200">
                            <i class="fas fa-book-open mr-3"></i> My Courses
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" class="flex items-center text-gray-300 hover:text-white transition duration-200">
                            <i class="fas fa-clipboard-check mr-3"></i> Assignments
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" class="flex items-center text-gray-300 hover:text-white transition duration-200">
                            <i class="fas fa-chart-line mr-3"></i> Grades
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" class="flex items-center text-gray-300 hover:text-white transition duration-200">
                            <i class="fas fa-calendar-alt mr-3"></i> Calendar
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" id="open-school-store-modal" class="flex items-center text-gray-300 hover:text-white transition duration-200">
                            <i class="fas fa-store mr-3"></i> School Store
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <div class="flex-1 p-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Welcome, Student!</h1>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow-md col-span-2">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Upcoming Assignments</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg assignment-card cursor-pointer" id="open-assignment-modal-1">
                            <h3 class="font-bold text-lg text-red-800 mb-2">Mathematics: Algebra II Homework</h3>
                            <p class="text-gray-700 text-sm mb-1">Due: June 15, 2025</p>
                            <p class="text-gray-700 text-sm mb-1">Time Remaining: <span id="timer-1" class="font-semibold text-red-600 pulse">59:45</span></p>
                            <p class="text-gray-700 text-sm">Status: Not Started</p>
                        </div>
                        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg assignment-card cursor-pointer" id="open-assignment-modal-2">
                            <h3 class="font-bold text-lg text-yellow-800 mb-2">Science: Biology Lab Report</h3>
                            <p class="text-gray-700 text-sm mb-1">Due: June 20, 2025</p>
                            <p class="text-gray-700 text-sm">Status: In Progress</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Announcements</h2>
                    <ul class="list-disc list-inside text-gray-700">
                        <li class="mb-2">School assembly on Friday at 10 AM.</li>
                        <li class="mb-2">New library books available next week!</li>
                        <li>Reminder: Submit consent forms for the field trip.</li>
                    </ul>
                    <div class="mt-6">
                        <h3 class="font-semibold text-lg text-gray-800 mb-2">Quick Access</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 text-sm"><i class="fas fa-envelope mr-2"></i>Message Teacher</button>
                            <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 text-sm"><i class="fas fa-calendar-alt mr-2"></i>School Calendar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">My Courses</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg course-card cursor-pointer">
                            <h3 class="font-bold text-lg text-blue-800 mb-2">Mathematics - Grade 7</h3>
                            <p class="text-gray-700 text-sm mb-1">Teacher: Mr. Phiri</p>
                            <p class="text-gray-700 text-sm">Progress: 85%</p>
                        </div>
                        <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg course-card cursor-pointer">
                            <h3 class="font-bold text-lg text-green-800 mb-2">English - Grade 7</h3>
                            <p class="text-gray-700 text-sm mb-1">Teacher: Ms. Zulu</p>
                            <p class="text-gray-700 text-sm">Progress: 90%</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Grades Overview</h2>
                    <p class="text-gray-700 mb-4">Latest grades for your subjects.</p>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-700">Mathematics:</span>
                        <div class="w-2/3 bg-gray-200 rounded-full h-2.5">
                            <div class="bg-blue-600 h-2.5 rounded-full" style="width: 88%;"></div>
                        </div>
                        <span class="text-gray-700 text-sm">B+ (88%)</span>
                    </div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-700">English:</span>
                        <div class="w-2/3 bg-gray-200 rounded-full h-2.5">
                            <div class="bg-green-600 h-2.5 rounded-full" style="width: 92%;"></div>
                        </div>
                        <span class="text-gray-700 text-sm">A (92%)</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-700">Science:</span>
                        <div class="w-2/3 bg-gray-200 rounded-full h-2.5">
                            <div class="bg-red-600 h-2.5 rounded-full" style="width: 75%;"></div>
                        </div>
                        <span class="text-gray-700 text-sm">C (75%)</span>
                    </div>
                    <button class="mt-6 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700"><i class="fas fa-list-alt mr-2"></i>View All Grades</button>
                </div>
            </div>
            </div>
    </div>

    <div id="assignment-modal" class="modal hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
            <h2 id="assignment-modal-title" class="text-2xl font-bold mb-4 text-gray-800 text-center">Assignment Title</h2>
            <p id="assignment-modal-due" class="text-gray-600 text-center mb-4">Due: </p>
            <div id="assignment-modal-timer-section" class="text-center mb-6">
                <p class="text-lg text-gray-700">Time Remaining:</p>
                <p id="assignment-modal-timer" class="text-4xl font-bold text-red-600 mt-2">00:00</p>
            </div>
            <p id="assignment-modal-description" class="text-gray-700 mb-6">Detailed description of the assignment goes here.</p>
            <div class="flex items-center justify-center space-x-4">
                <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-300"><i class="fas fa-upload mr-2"></i>Submit Assignment</button>
                <button type="button" id="close-assignment-modal" class="text-gray-500 hover:text-gray-700 text-sm">Close</button>
            </div>
        </div>
    </div>

    <div id="school-store-modal" class="modal hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 text-center">EduMalawi School Store</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="border p-4 rounded-lg text-center">
                    <img src="https://via.placeholder.com/100" alt="Item 1" class="mx-auto mb-3 rounded-lg">
                    <h3 class="font-bold text-lg mb-1">School T-Shirt</h3>
                    <p class="text-gray-700 mb-3">K5,000</p>
                    <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">Add to Cart</button>
                </div>
                <div class="border p-4 rounded-lg text-center">
                    <img src="https://via.placeholder.com/100" alt="Item 2" class="mx-auto mb-3 rounded-lg">
                    <h3 class="font-bold text-lg mb-1">Branded Notebook</h3>
                    <p class="text-gray-700 mb-3">K2,500</p>
                    <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">Add to Cart</button>
                </div>
            </div>
            <div class="flex items-center justify-center mt-6">
                <button type="button" id="close-school-store-modal" class="text-gray-500 hover:text-gray-700 text-sm">Close Store</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('mobile-menu-button').addEventListener('click', function() {
                const menu = document.getElementById('mobile-menu');
                menu.classList.toggle('hidden');
            });

            // --- Assignment Modal Logic ---
            const assignmentModal = document.getElementById('assignment-modal');
            const closeAssignmentModalBtn = document.getElementById('close-assignment-modal');
            let timerInterval; // To store the interval ID for the timer

            function showAssignmentModal(title, due, description, timerRequired = false) {
                document.getElementById('assignment-modal-title').textContent = title;
                document.getElementById('assignment-modal-due').textContent = `Due: ${due}`;
                document.getElementById('assignment-modal-description').textContent = description;

                const timerSection = document.getElementById('assignment-modal-timer-section');
                if (timerRequired) {
                    timerSection.classList.remove('hidden');
                    startTimer(); // Start the timer function
                } else {
                    timerSection.classList.add('hidden');
                    clearInterval(timerInterval); // Clear any running timer
                }

                assignmentModal.classList.remove('hidden');
            }

            function hideAssignmentModal() {
                assignmentModal.classList.add('hidden');
                clearInterval(timerInterval); // Ensure timer stops when modal closes
            }

            document.getElementById('open-assignment-modal-1').addEventListener('click', function() {
                showAssignmentModal(
                    "Mathematics: Algebra II Homework",
                    "June 15, 2025",
                    "Complete exercises 3.1, 3.2, and 3.3 from your textbook. Show all your work for full credit. Remember to use the methods discussed in class.",
                    true // This assignment has a timer
                );
            });

            document.getElementById('open-assignment-modal-2').addEventListener('click', function() {
                showAssignmentModal(
                    "Science: Biology Lab Report",
                    "June 20, 2025",
                    "Write a detailed lab report on the plant growth experiment. Include introduction, materials, procedure, results, discussion, and conclusion.",
                    false // This assignment does not have a timer
                );
            });

            closeAssignmentModalBtn.addEventListener('click', hideAssignmentModal);

            // Function to simulate a countdown timer for assignments
            function startTimer() {
                let minutes = 59;
                let seconds = 45;
                const timerElement = document.getElementById('assignment-modal-timer'); // Use the modal's timer element

                timerInterval = setInterval(() => {
                    if (seconds === 0) {
                        if (minutes === 0) {
                            clearInterval(timerInterval);
                            timerElement.textContent = "Time's up!";
                            return;
                        }
                        minutes--;
                        seconds = 59;
                    } else {
                        seconds--;
                    }

                    const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;
                    const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;
                    timerElement.textContent = `${formattedMinutes}:${formattedSeconds}`;

                    // Update the timer on the card as well
                    const cardTimerElement = document.getElementById('timer-1');
                    if (cardTimerElement) {
                        cardTimerElement.textContent = `${formattedMinutes}:${formattedSeconds}`;
                        if (minutes <= 5 && !cardTimerElement.classList.contains('pulse')) {
                            cardTimerElement.classList.add('pulse'); // Add pulse animation for low time
                        }
                    }
                }, 1000);
            }

            // --- School Store Modal Logic ---
            const schoolStoreModal = document.getElementById('school-store-modal');
            const openSchoolStoreBtn = document.getElementById('open-school-store-modal');
            const closeSchoolStoreModalBtn = document.getElementById('close-school-store-modal');

            openSchoolStoreBtn.addEventListener('click', function() {
                schoolStoreModal.classList.remove('hidden');
            });

            closeSchoolStoreModalBtn.addEventListener('click', function() {
                schoolStoreModal.classList.add('hidden');
            });

            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === assignmentModal) {
                    hideAssignmentModal();
                }
                if (event.target === schoolStoreModal) {
                    schoolStoreModal.classList.add('hidden');
                }
            });

            // --- Real-time Notifications Logic START ---
            const notificationBell = document.getElementById('notification-bell');
            const notificationBadge = document.getElementById('notification-badge');
            const notificationsDropdown = document.getElementById('notifications-dropdown');
            const notificationList = document.getElementById('notification-list');
            const markAllReadBtn = document.getElementById('mark-all-read');

            let notifications = [
                { id: 1, message: "New assignment posted in Mathematics: Algebra II Homework.", read: false, time: '30 mins ago' },
                { id: 2, message: "Your English grade has been updated to A.", read: false, time: '1 hour ago' },
                { id: 3, message: "Reminder: School assembly on Friday at 10 AM.", read: true, time: 'yesterday' }
            ];

            function updateNotificationsUI() {
                notificationList.innerHTML = ''; // Clear existing list
                let unreadCount = 0;

                if (notifications.length === 0) {
                    notificationList.innerHTML = '<li class="py-2 text-gray-700 text-sm">No new notifications.</li>';
                } else {
                    notifications.forEach(notif => {
                        const li = document.createElement('li');
                        li.classList.add('py-2', 'text-gray-700', 'text-sm', 'flex', 'justify-between', 'items-center');
                        if (!notif.read) {
                            li.classList.add('font-semibold', 'text-gray-900');
                            unreadCount++;
                        }

                        li.innerHTML = `
                            <div>${notif.message} <span class="text-gray-500 text-xs ml-1">${notif.time}</span></div>
                            <button data-id="${notif.id}" class="mark-as-read text-indigo-500 hover:text-indigo-700 text-xs">${notif.read ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-circle"></i>'}</button>
                        `;
                        notificationList.appendChild(li);
                    });
                }

                if (unreadCount > 0) {
                    notificationBadge.textContent = unreadCount;
                    notificationBadge.classList.remove('hidden');
                } else {
                    notificationBadge.classList.add('hidden');
                }
            }

            // Initial UI update
            updateNotificationsUI();

            // Toggle dropdown
            notificationBell.addEventListener('click', function(event) {
                event.stopPropagation(); // Prevent document click from closing immediately
                notificationsDropdown.classList.toggle('hidden');
                // Mark all currently displayed as read when opened
                notifications.forEach(notif => notif.read = true);
                updateNotificationsUI();
            });

            // Mark individual notification as read
            notificationList.addEventListener('click', function(event) {
                if (event.target.classList.contains('mark-as-read') || event.target.closest('.mark-as-read')) {
                    const button = event.target.closest('.mark-as-read');
                    const notifId = parseInt(button.dataset.id);
                    const notifIndex = notifications.findIndex(n => n.id === notifId);
                    if (notifIndex !== -1) {
                        notifications[notifIndex].read = true;
                        updateNotificationsUI();
                    }
                }
            });

            // Mark all notifications as read button
            markAllReadBtn.addEventListener('click', function() {
                notifications.forEach(notif => notif.read = true);
                updateNotificationsUI();
                notificationsDropdown.classList.add('hidden'); // Close dropdown after marking all as read
            });

            // Close dropdown when clicking outside
            window.addEventListener('click', function(event) {
                if (!notificationBell.contains(event.target) && !notificationsDropdown.contains(event.target)) {
                    notificationsDropdown.classList.add('hidden');
                }
            });

            // Example of adding a new notification (simulate a real-time event for students)
            function addNewNotification(message) {
                const newId = notifications.length > 0 ? Math.max(...notifications.map(n => n.id)) + 1 : 1;
                notifications.unshift({ id: newId, message: message, read: false, time: 'just now' });
                updateNotificationsUI();
                if (notificationsDropdown.classList.contains('hidden')) {
                    notificationBadge.classList.remove('hidden');
                    notificationBadge.textContent = parseInt(notificationBadge.textContent) + 1;
                }
            }

            // Simulate a new student notification after 15 seconds
            setTimeout(() => {
                addNewNotification('Your Science teacher, Ms. Zulu, has posted new feedback on your lab report.');
            }, 15000);
            // --- Real-time Notifications Logic END ---
        });
    </script>
</body>
</html>